
<!-- FILE: features.html -->
<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ASTRIONHUB — Features</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Inter", "ui-sans-serif", "system-ui"],
            mono: ["JetBrains Mono", "ui-monospace", "SFMono-Regular"]
          },
          keyframes: {
            shimmer: { "0%": { transform: "translateX(-120%)" }, "100%": { transform: "translateX(120%)" } },
          },
          animation: { shimmer: "shimmer 2.8s ease-in-out infinite" }
        }
      }
    }
  </script>

  <style>
    :root{ --bg0:#070A12; --bg1:#0A1020; }
    html{ scroll-behavior:smooth; }
    body{
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(124,92,255,.18), transparent 60%),
        radial-gradient(900px 650px at 85% 15%, rgba(25,211,255,.14), transparent 60%),
        radial-gradient(900px 700px at 40% 92%, rgba(46,229,157,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }

    /* Background layers: always behind content */
    .bg-grid{
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 44px 44px;
      opacity: .22;
    }
    .bg-vignette{
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background: radial-gradient(70% 55% at 50% 35%, transparent 0%, rgba(0,0,0,.25) 60%, rgba(0,0,0,.58) 100%);
    }
    .app{
      position: relative;
      z-index: 1;
    }

    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.045));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }
    .glass-strong{
      background: linear-gradient(180deg, rgba(255,255,255,.11), rgba(255,255,255,.055));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset, 0 20px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    .g-border{
      position: relative;
      border-radius: 16px;
      padding: 1px;
      overflow: hidden; /* IMPORTANT: prevent border spill */
      background: linear-gradient(120deg,
        rgba(124,92,255,.55),
        rgba(25,211,255,.35),
        rgba(46,229,157,.25),
        rgba(255,255,255,.10)
      );
    }
    .g-border > .inner{
      border-radius: 15px;
      background: linear-gradient(180deg, rgba(10,16,32,.85), rgba(7,10,18,.72));
      border: 1px solid rgba(255,255,255,.10);
    }
    .btn-shine{ position:relative; overflow:hidden; }
    .btn-shine::after{
      content:"";
      position:absolute; top:-30%; left:-60%;
      width:50%; height:160%;
      transform: rotate(18deg);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
      animation: shimmer 2.8s ease-in-out infinite;
      opacity: .55;
    }
    .reveal{ opacity:0; transform: translateY(12px); transition: opacity .7s ease, transform .7s ease; }
    .reveal.show{ opacity:1; transform: translateY(0); }

    .scrollbar::-webkit-scrollbar{ width: 10px; height: 10px; }
    .scrollbar::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.12); border-radius: 999px; }
    .scrollbar::-webkit-scrollbar-track{ background: rgba(255,255,255,.06); border-radius: 999px; }

    .clamp3{
      display:-webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
  </style>
</head>

<body class="text-white font-sans selection:bg-white/15 selection:text-white overflow-x-hidden min-h-screen">
  <div class="bg-grid"></div>
  <div class="bg-vignette"></div>

  <div class="app">
    <!-- NAV -->
    <header class="sticky top-0 z-50">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-3">
        <nav class="glass rounded-2xl px-4 sm:px-5 py-3 flex items-center justify-between">
          <a href="index.html" class="flex items-center gap-3 min-w-0">
            <div class="g-border h-10 w-10 rounded-xl overflow-hidden grid place-items-center flex-none">
              <div class="inner h-full w-full grid place-items-center">
                <div class="h-6 w-6 text-white/90" data-lucide="sparkles"></div>
              </div>
            </div>
            <div class="leading-tight min-w-0">
              <div class="text-sm text-white/85 font-semibold truncate">ASTRIONHUB</div>
              <div class="text-xs text-white/50 truncate">Features</div>
            </div>
          </a>

          <div class="hidden md:flex items-center gap-6 text-sm text-white/75">
            <a class="hover:text-white transition" href="features.html">Features</a>
            <a class="hover:text-white transition" href="demo.html">Demo</a>
            <a class="hover:text-white transition" href="pricing.html">Pricing</a>
            <a class="hover:text-white transition" href="index.html#faq">FAQ</a>
            <a class="hover:text-white transition" href="contact.html">Contact</a>
          </div>

          <button id="btnMenu" class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 transition" aria-label="Open menu">
            <span class="h-5 w-5" data-lucide="menu"></span>
          </button>
        </nav>

        <div id="mobileMenu" class="hidden md:hidden mt-3 glass rounded-2xl px-4 py-3">
          <div class="grid gap-1 text-sm text-white/80">
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="features.html">Features</a>
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="demo.html">Demo</a>
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="pricing.html">Pricing</a>
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="index.html#faq">FAQ</a>
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="contact.html">Contact</a>
          </div>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-10 pb-14">
      <section class="reveal">
        <div class="g-border max-w-full">
          <div class="inner glass-strong rounded-2xl p-6 sm:p-8 max-w-full">
            <div class="flex items-start justify-between gap-4 flex-wrap">
              <div class="min-w-0">
                <div class="text-xs text-white/55">Features</div>
                <h1 class="mt-2 text-3xl sm:text-4xl font-extrabold tracking-tight">Status board</h1>
                <p class="mt-3 text-white/70 max-w-2xl">
                  Statistik di atas, dan fitur dikelompokkan berdasarkan tag: NEW, UPDATE, ERROR, MAINTENANCE.
                </p>
              </div>

              <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
                <button id="btnRefresh"
                  class="inline-flex w-full sm:w-auto items-center justify-center gap-2 px-4 py-2.5 rounded-2xl border border-white/12 bg-white/5 hover:bg-white/8 transition">
                  <span class="h-4 w-4" data-lucide="refresh-cw"></span>
                  <span class="text-sm font-semibold">Refresh</span>
                </button>

                <button id="btnResetNew"
                  class="btn-shine inline-flex w-full sm:w-auto items-center justify-center gap-2 px-4 py-2.5 rounded-2xl bg-white text-black hover:bg-white/90 transition">
                  <span class="h-4 w-4" data-lucide="badge-check"></span>
                  <span class="text-sm font-semibold">Reset NEW</span>
                </button>

                <button id="btnOpenJson"
                  class="inline-flex w-full sm:w-auto items-center justify-center gap-2 px-4 py-2.5 rounded-2xl border border-white/12 bg-white/5 hover:bg-white/8 transition">
                  <span class="h-4 w-4" data-lucide="link"></span>
                  <span class="text-sm font-semibold">JSON</span>
                </button>
              </div>
            </div>

            <div class="mt-5 flex items-center justify-between gap-3 flex-wrap text-xs text-white/55">
              <div class="flex items-center gap-2 min-w-0">
                <span class="h-4 w-4 flex-none" data-lucide="activity"></span>
                <span id="metaInfo" class="text-white/60 truncate">Idle</span>
              </div>
              <div class="text-white/45" id="lastUpdated"></div>
            </div>

            <!-- STATES -->
            <div id="stateLoading" class="mt-7 grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
              <div class="glass rounded-2xl border border-white/10 p-5 animate-pulse">
                <div class="h-5 w-28 bg-white/10 rounded"></div>
                <div class="mt-3 h-4 w-full bg-white/8 rounded"></div>
                <div class="mt-2 h-4 w-5/6 bg-white/8 rounded"></div>
              </div>
              <div class="glass rounded-2xl border border-white/10 p-5 animate-pulse">
                <div class="h-5 w-24 bg-white/10 rounded"></div>
                <div class="mt-3 h-4 w-full bg-white/8 rounded"></div>
                <div class="mt-2 h-4 w-2/3 bg-white/8 rounded"></div>
              </div>
              <div class="glass rounded-2xl border border-white/10 p-5 animate-pulse">
                <div class="h-5 w-32 bg-white/10 rounded"></div>
                <div class="mt-3 h-4 w-full bg-white/8 rounded"></div>
                <div class="mt-2 h-4 w-4/5 bg-white/8 rounded"></div>
              </div>
            </div>

            <div id="stateError" class="hidden mt-7 glass rounded-2xl border border-rose-300/15 bg-rose-500/10 p-5">
              <div class="flex items-start gap-3 min-w-0">
                <span class="h-5 w-5 text-rose-200 flex-none" data-lucide="triangle-alert"></span>
                <div class="min-w-0">
                  <div class="font-semibold text-rose-100">Gagal load feature.json</div>
                  <div id="errorText" class="mt-1 text-sm text-rose-100/80 break-words"></div>
                </div>
              </div>
            </div>

            <div id="stateEmpty" class="hidden mt-7 glass rounded-2xl border border-white/10 p-5">
              <div class="flex items-start gap-3 min-w-0">
                <span class="h-5 w-5 text-white/70 flex-none" data-lucide="inbox"></span>
                <div class="min-w-0">
                  <div class="font-semibold text-white/85">Belum ada feature</div>
                  <div class="mt-1 text-sm text-white/65">Isi file JSON dulu, nanti otomatis tampil di sini.</div>
                </div>
              </div>
            </div>

            <!-- STATS TOP -->
            <div id="statsPanel" class="hidden mt-7 grid grid-cols-2 lg:grid-cols-5 gap-3">
              <div class="glass rounded-2xl border border-white/10 p-4">
                <div class="flex items-center justify-between text-xs text-white/60">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="layers"></span>Total</span>
                  <span class="h-2.5 w-2.5 rounded-full bg-emerald-400"></span>
                </div>
                <div class="mt-3 text-3xl font-extrabold tracking-tight" id="statTotal">0</div>
              </div>

              <div class="glass rounded-2xl border border-white/10 p-4">
                <div class="flex items-center justify-between text-xs text-white/60">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="sparkles"></span>New</span>
                  <span class="h-2.5 w-2.5 rounded-full bg-cyan-300"></span>
                </div>
                <div class="mt-3 text-3xl font-extrabold tracking-tight" id="statNew">0</div>
                <div class="mt-2 text-[11px] text-white/45">Max 2 • TTL 24h</div>
              </div>

              <div class="glass rounded-2xl border border-white/10 p-4">
                <div class="flex items-center justify-between text-xs text-white/60">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="arrow-up-right"></span>Update</span>
                  <span class="h-2.5 w-2.5 rounded-full bg-violet-300"></span>
                </div>
                <div class="mt-3 text-3xl font-extrabold tracking-tight" id="statUpdate">0</div>
              </div>

              <div class="glass rounded-2xl border border-white/10 p-4">
                <div class="flex items-center justify-between text-xs text-white/60">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="triangle-alert"></span>Error</span>
                  <span class="h-2.5 w-2.5 rounded-full bg-rose-400"></span>
                </div>
                <div class="mt-3 text-3xl font-extrabold tracking-tight" id="statErr">0</div>
              </div>

              <div class="glass rounded-2xl border border-white/10 p-4 col-span-2 lg:col-span-1">
                <div class="flex items-center justify-between text-xs text-white/60">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="wrench"></span>Maintenance</span>
                  <span class="h-2.5 w-2.5 rounded-full bg-amber-300"></span>
                </div>
                <div class="mt-3 text-3xl font-extrabold tracking-tight" id="statMaint">0</div>
              </div>
            </div>

            <!-- LIST BY TAGS -->
            <div id="tagBoard" class="hidden mt-6 grid lg:grid-cols-12 gap-4">
              <div class="lg:col-span-6 space-y-4">
                <div class="glass rounded-2xl border border-white/10 p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div class="flex items-center gap-2 text-white/85 font-semibold">
                      <span class="h-4 w-4" data-lucide="sparkles"></span>
                      <span>NEW</span>
                      <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[11px] bg-cyan-400/12 border border-cyan-300/15 text-cyan-100" id="badgeNew">0</span>
                    </div>
                    <div class="text-xs text-white/55">Last 24h</div>
                  </div>
                  <div id="listNew" class="mt-4 grid gap-2"></div>
                </div>

                <div class="glass rounded-2xl border border-white/10 p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div class="flex items-center gap-2 text-white/85 font-semibold">
                      <span class="h-4 w-4" data-lucide="arrow-up-right"></span>
                      <span>UPDATE</span>
                      <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[11px] bg-violet-400/12 border border-violet-300/15 text-violet-100" id="badgeUpdate">0</span>
                    </div>
                    <div class="text-xs text-white/55">Changes</div>
                  </div>
                  <div id="listUpdate" class="mt-4 grid gap-2 max-h-[420px] overflow-auto pr-1 scrollbar"></div>
                </div>
              </div>

              <div class="lg:col-span-6 space-y-4">
                <div class="glass rounded-2xl border border-white/10 p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div class="flex items-center gap-2 text-white/85 font-semibold">
                      <span class="h-4 w-4" data-lucide="triangle-alert"></span>
                      <span>ERROR</span>
                      <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[11px] bg-rose-400/12 border border-rose-300/15 text-rose-100" id="badgeError">0</span>
                    </div>
                    <div class="text-xs text-white/55">Issues</div>
                  </div>
                  <div id="listError" class="mt-4 grid gap-2"></div>
                </div>

                <div class="glass rounded-2xl border border-white/10 p-5">
                  <div class="flex items-center justify-between gap-3">
                    <div class="flex items-center gap-2 text-white/85 font-semibold">
                      <span class="h-4 w-4" data-lucide="wrench"></span>
                      <span>MAINTENANCE</span>
                      <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[11px] bg-amber-400/12 border border-amber-300/15 text-amber-100" id="badgeMaint">0</span>
                    </div>
                    <div class="text-xs text-white/55">Downtime</div>
                  </div>
                  <div id="listMaint" class="mt-4 grid gap-2"></div>
                </div>
              </div>
            </div>
          </div><!-- inner -->
        </div><!-- g-border -->
      </section>
    </main>

    <footer class="border-t border-white/10">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between">
        <div class="text-sm text-white/55">© <span id="year"></span> ASTRIONHUB</div>
        <div class="flex flex-wrap gap-2 text-sm">
          <a href="index.html" class="px-3 py-1.5 rounded-full border border-white/10 bg-white/5 hover:bg-white/8 transition text-white/70">Home</a>
          <a href="pricing.html" class="px-3 py-1.5 rounded-full border border-white/10 bg-white/5 hover:bg-white/8 transition text-white/70">Pricing</a>
          <a href="contact.html" class="px-3 py-1.5 rounded-full border border-white/10 bg-white/5 hover:bg-white/8 transition text-white/70">Contact</a>
        </div>
      </div>
    </footer>
  </div><!-- app -->

  <script>
    // ===== CONFIG =====
    const FEATURES_URLS = [
      "https://raw.githubusercontent.com/septianhdnatta/Website-/refs/heads/main/db/feature.json",
      "https://raw.githubusercontent.com/septianhdnatta/Website-/main/db/feature.json"
    ];

    const NEW_TTL_MS = 24 * 60 * 60 * 1000; // 24 jam
    const NEW_LIMIT = 2;                    // tampil max 1-2
    const SEEN_TS_KEY = "astrionhub_feature_first_seen_ts_v2"; // bump key to avoid old bug states

    const $ = (id) => document.getElementById(id);
    const safeText = (v, fallback="") => (v === null || v === undefined) ? fallback : String(v);

    function escapeHTML(str) {
      const s = safeText(str, "");
      return s.replace(/[&<>"']/g, (ch) => ({
        "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#039;"
      }[ch]));
    }

    // Prevent overflow from super-long tokens (no spaces)
    function softWrap(str, chunk = 28) {
      const s = safeText(str, "");
      const re = new RegExp("(\\S{" + chunk + "})(?=\\S)", "g");
      return s.replace(re, "$1\u200B");
    }

    function normalizeItems(data) {
      if (Array.isArray(data)) return data;
      if (data && Array.isArray(data.features)) return data.features;
      if (data && Array.isArray(data.items)) return data.items;
      if (data && Array.isArray(data.data)) return data.data;
      return [];
    }

    function truthy(v) {
      return v === true || v === 1 || v === "1" || (typeof v === "string" && v.toLowerCase() === "true");
    }

    function getFeatureKey(item, idx) {
      return safeText(item.id ?? item.key ?? item.slug ?? item.code ?? item.title ?? item.name ?? idx).trim();
    }

    function getRawTag(item) {
      let t = item.tag ?? item.status ?? item.badge ?? item.type ?? "";
      if (Array.isArray(t)) t = t[0] ?? "";
      t = String(t).toLowerCase().trim();

      if (t === "baru") t = "new";
      if (t === "updated") t = "update";
      if (t === "bug") t = "error";
      if (t === "maint") t = "maintenance";

      if (!t) {
        if (truthy(item.new) || truthy(item.isNew) || truthy(item.is_new)) t = "new";
        else if (truthy(item.maintenance) || truthy(item.maint)) t = "maintenance";
        else if (truthy(item.error) || truthy(item.isError)) t = "error";
        else if (truthy(item.update) || truthy(item.updated)) t = "update";
      }

      if (!["new","update","error","maintenance"].includes(t)) t = "update";
      return t;
    }

    function safeUrl(raw) {
      const v = safeText(raw, "").trim();
      if (!v) return "";
      try {
        const u = new URL(v, location.href);
        if (u.protocol === "http:" || u.protocol === "https:") return u.href;
      } catch {}
      return "";
    }

    function getSeenMap() {
      try {
        const raw = localStorage.getItem(SEEN_TS_KEY);
        if (!raw) return {};
        const obj = JSON.parse(raw);
        return (obj && typeof obj === "object") ? obj : {};
      } catch { return {}; }
    }

    function saveSeenMap(obj) {
      try { localStorage.setItem(SEEN_TS_KEY, JSON.stringify(obj)); } catch {}
    }

    function show(el, yes) { el.classList.toggle("hidden", !yes); }

    function badgeHTML(tag) {
      if (tag === "new") return `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold bg-cyan-400/12 border border-cyan-300/15 text-cyan-100">NEW</span>`;
      if (tag === "update") return `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold bg-violet-400/12 border border-violet-300/15 text-violet-100">UPDATE</span>`;
      if (tag === "error") return `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold bg-rose-400/12 border border-rose-300/15 text-rose-100">ERROR</span>`;
      return `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold bg-amber-400/12 border border-amber-300/15 text-amber-100">MAINT</span>`;
    }

    function iconForTag(tag) {
      if (tag === "new") return "sparkles";
      if (tag === "update") return "arrow-up-right";
      if (tag === "error") return "triangle-alert";
      return "wrench";
    }

    function renderItemCard(item) {
      const title = softWrap(escapeHTML(item.title ?? item.name ?? "Untitled"), 26);
      const desc  = softWrap(escapeHTML(item.description ?? item.desc ?? item.detail ?? item.text ?? ""), 34);

      const icon = safeText(item.icon ?? item.lucide ?? iconForTag(item.__tag)).trim() || iconForTag(item.__tag);
      const link = safeUrl(item.link ?? item.url ?? item.href ?? "");

      const tagOpen = link ? "a" : "div";
      const hrefAttr = link ? `href="${link}" target="_blank" rel="noreferrer"` : "";

      return `
        <${tagOpen} ${hrefAttr}
          class="glass rounded-2xl border border-white/10 p-4 hover:bg-white/7 hover:border-white/20 transition max-w-full">
          <div class="flex items-start gap-3 min-w-0">
            <div class="h-10 w-10 rounded-2xl border border-white/10 bg-white/5 grid place-items-center flex-none">
              <span class="h-5 w-5 text-white/85" data-lucide="${icon}"></span>
            </div>

            <div class="min-w-0 flex-1">
              <div class="flex items-center gap-2 min-w-0">
                <div class="font-semibold text-white/90 truncate min-w-0">${title}</div>
                ${badgeHTML(item.__tag)}
              </div>
              <div class="mt-1 text-sm text-white/65 break-words clamp3">${desc || "—"}</div>
            </div>

            ${link ? `<span class="h-4 w-4 text-white/55 mt-1 flex-none" data-lucide="arrow-up-right"></span>` : ""}
          </div>
        </${tagOpen}>
      `;
    }

    function setStats({ total=0, nNew=0, nUpdate=0, nErr=0, nMaint=0 }) {
      $("statTotal").textContent = String(total);
      $("statNew").textContent = String(nNew);
      $("statUpdate").textContent = String(nUpdate);
      $("statErr").textContent = String(nErr);
      $("statMaint").textContent = String(nMaint);
      show($("statsPanel"), true);
    }

    function setBadges({ nNew=0, nUpdate=0, nErr=0, nMaint=0 }) {
      $("badgeNew").textContent = String(nNew);
      $("badgeUpdate").textContent = String(nUpdate);
      $("badgeError").textContent = String(nErr);
      $("badgeMaint").textContent = String(nMaint);
    }

    async function fetchFirstWorkingJson() {
      let lastErr = null;
      for (const base of FEATURES_URLS) {
        try {
          const url = base + (base.includes("?") ? "&" : "?") + "t=" + Date.now();
          const res = await fetch(url, { cache: "no-store" });
          if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
          const lastModified = res.headers.get("last-modified");
          const data = await res.json();
          return { base, data, lastModified };
        } catch (e) {
          lastErr = e;
        }
      }
      throw lastErr || new Error("Fetch failed");
    }

    async function loadFeatures() {
      show($("stateLoading"), true);
      show($("stateError"), false);
      show($("stateEmpty"), false);
      show($("statsPanel"), false);
      show($("tagBoard"), false);

      $("listNew").innerHTML = "";
      $("listUpdate").innerHTML = "";
      $("listError").innerHTML = "";
      $("listMaint").innerHTML = "";

      $("metaInfo").textContent = "Loading…";
      $("lastUpdated").textContent = "";

      const now = Date.now();
      let seenMap = getSeenMap();

      try {
        const { base, data, lastModified } = await fetchFirstWorkingJson();
        const itemsRaw = normalizeItems(data);

        $("btnOpenJson").onclick = () => window.open(base, "_blank", "noopener,noreferrer");

        if (!itemsRaw.length) {
          show($("stateLoading"), false);
          show($("stateEmpty"), true);
          $("metaInfo").textContent = "Empty";
          setStats({ total: 0, nNew: 0, nUpdate: 0, nErr: 0, nMaint: 0 });
          setBadges({ nNew: 0, nUpdate: 0, nErr: 0, nMaint: 0 });
          show($("tagBoard"), true);
          lucide.createIcons(); /* icons after DOM changes */ 
          return;
        }

        // prune map -> TTL 24h
        const pruned = {};
        for (const [k, v] of Object.entries(seenMap)) {
          const n = Number(v);
          if (Number.isFinite(n) && (now - n) <= NEW_TTL_MS) pruned[k] = n;
        }
        seenMap = pruned;

        // Decorate + first seen
        const items = itemsRaw.map((it, idx) => {
          const key = getFeatureKey(it, idx);
          if (seenMap[key] === undefined) seenMap[key] = now;
          return { ...it, __key: key, __idx: idx };
        });

        // Tag resolution (priority)
        const decorated = items.map(it => {
          const rawTag = getRawTag(it);
          const firstSeen = Number(seenMap[it.__key] ?? now);
          const ageOk = (now - firstSeen) <= NEW_TTL_MS;

          let finalTag = "update";
          if (rawTag === "error" || rawTag === "maintenance") finalTag = rawTag;
          else if (rawTag === "new") finalTag = ageOk ? "new" : "update";
          else if (ageOk && firstSeen === now) finalTag = "new";
          else finalTag = rawTag || "update";

          return { ...it, __tag: finalTag, __rawTag: rawTag, __firstSeen: firstSeen };
        });

        // NEW candidates: within TTL, then show max 2 (latest first)
        const newCandidates = decorated.filter(it => it.__tag === "new" && (now - it.__firstSeen) <= NEW_TTL_MS);
        newCandidates.sort((a, b) => (b.__firstSeen ?? 0) - (a.__firstSeen ?? 0));
        const newShow = newCandidates.slice(0, NEW_LIMIT);
        const newKeys = new Set(newShow.map(it => it.__key));

        // Other lists (no duplication)
        const updateList = decorated.filter(it => it.__tag === "update" && !newKeys.has(it.__key));
        const errorList  = decorated.filter(it => it.__tag === "error" && !newKeys.has(it.__key));
        const maintList  = decorated.filter(it => it.__tag === "maintenance" && !newKeys.has(it.__key));

        // Render
        $("listNew").innerHTML = newShow.length
          ? newShow.map(renderItemCard).join("")
          : `<div class="text-sm text-white/55">Tidak ada NEW (24 jam terakhir).</div>`;

        $("listUpdate").innerHTML = updateList.length
          ? updateList.map(renderItemCard).join("")
          : `<div class="text-sm text-white/55">Tidak ada UPDATE.</div>`;

        $("listError").innerHTML = errorList.length
          ? errorList.map(renderItemCard).join("")
          : `<div class="text-sm text-white/55">Tidak ada ERROR.</div>`;

        $("listMaint").innerHTML = maintList.length
          ? maintList.map(renderItemCard).join("")
          : `<div class="text-sm text-white/55">Tidak ada MAINTENANCE.</div>`;

        // Save pruned timestamps (auto “hapus” setelah 24h)
        saveSeenMap(seenMap);

        // Stats
        const total = decorated.length;
        const nNew = newShow.length;
        const nUpdate = updateList.length;
        const nErr = errorList.length;
        const nMaint = maintList.length;

        setStats({ total, nNew, nUpdate, nErr, nMaint });
        setBadges({ nNew, nUpdate, nErr, nMaint });

        $("metaInfo").textContent = `Loaded ${total} • NEW ${nNew} • UPDATE ${nUpdate} • ERROR ${nErr} • MAINT ${nMaint}`;
        $("lastUpdated").textContent = lastModified ? `Updated: ${lastModified}` : "";

        show($("stateLoading"), false);
        show($("statsPanel"), true);
        show($("tagBoard"), true);

        // IMPORTANT: render icons after HTML injection
        lucide.createIcons(); /* replaces data-lucide nodes */ /* [web:18] */
      } catch (e) {
        show($("stateLoading"), false);
        show($("stateError"), true);
        $("errorText").textContent = e?.message ? String(e.message) : "Unknown error";

        $("metaInfo").textContent = "Fetch error";
        $("lastUpdated").textContent = "";

        setStats({ total: 0, nNew: 0, nUpdate: 0, nErr: 1, nMaint: 0 });
        setBadges({ nNew: 0, nUpdate: 0, nErr: 1, nMaint: 0 });

        show($("tagBoard"), true);
        lucide.createIcons(); /* [web:18] */
      }
    }

    // ===== Boot =====
    (function boot() {
      lucide.createIcons(); /* [web:18] */
      $("year").textContent = new Date().getFullYear();

      const btnMenu = $("btnMenu");
      const mobileMenu = $("mobileMenu");
      btnMenu?.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));
      mobileMenu?.querySelectorAll("a").forEach(a => a.addEventListener("click", () => mobileMenu.classList.add("hidden")));

      $("btnRefresh")?.addEventListener("click", loadFeatures);
      $("btnResetNew")?.addEventListener("click", () => {
        localStorage.removeItem(SEEN_TS_KEY);
        loadFeatures();
      });

      const el = document.querySelector(".reveal");
      if (el) {
        const io = new IntersectionObserver((entries) => {
          entries.forEach(e => { if (e.isIntersecting) el.classList.add("show"); });
        }, { threshold: 0.12 });
        io.observe(el);
      } else {
        document.querySelectorAll(".reveal").forEach(x => x.classList.add("show"));
      }

      loadFeatures();
    })();
  </script>
</body>
</html>

