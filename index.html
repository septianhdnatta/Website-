<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ASTRIONHUB — Pricing</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Inter", "ui-sans-serif", "system-ui"],
            mono: ["JetBrains Mono", "ui-monospace", "SFMono-Regular"]
          },
          keyframes: {
            shimmer: { "0%": { transform: "translateX(-120%)" }, "100%": { transform: "translateX(120%)" } },
          },
          animation: { shimmer: "shimmer 2.8s ease-in-out infinite" }
        }
      }
    }
  </script>

  <style>
    :root{ --bg0:#070A12; --bg1:#0A1020; }
    html{ scroll-behavior:smooth; }
    body{
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(124,92,255,.18), transparent 60%),
        radial-gradient(900px 650px at 85% 15%, rgba(25,211,255,.14), transparent 60%),
        radial-gradient(900px 700px at 40% 92%, rgba(46,229,157,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      background-color:#070A12;
    }
    .bg-grid{
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background-image:
        linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 44px 44px;
      opacity: .22;
    }
    .bg-vignette{
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background: radial-gradient(70% 55% at 50% 35%, transparent 0%, rgba(0,0,0,.25) 60%, rgba(0,0,0,.58) 100%);
    }
    .app{ position: relative; z-index: 1; }

    .glass{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.045));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }
    .glass-strong{
      background: linear-gradient(180deg, rgba(255,255,255,.11), rgba(255,255,255,.055));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset, 0 20px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    .g-border{
      position: relative;
      border-radius: 16px;
      padding: 1px;
      overflow: hidden;
      background: linear-gradient(120deg,
        rgba(124,92,255,.55),
        rgba(25,211,255,.35),
        rgba(46,229,157,.25),
        rgba(255,255,255,.10)
      );
    }
    .g-border > .inner{
      border-radius: 15px;
      background: linear-gradient(180deg, rgba(10,16,32,.85), rgba(7,10,18,.72));
      border: 1px solid rgba(255,255,255,.10);
    }
    .btn-shine{ position:relative; overflow:hidden; }
    .btn-shine::after{
      content:"";
      position:absolute; top:-30%; left:-60%;
      width:50%; height:160%;
      transform: rotate(18deg);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
      animation: shimmer 2.8s ease-in-out infinite;
      opacity: .55;
    }
    .reveal{ opacity:0; transform: translateY(12px); transition: opacity .7s ease, transform .7s ease; }
    .reveal.show{ opacity:1; transform: translateY(0); }

    .mono{ font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .scrollbar::-webkit-scrollbar{ width: 10px; height: 10px; }
    .scrollbar::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.12); border-radius: 999px; }
    .scrollbar::-webkit-scrollbar-track{ background: rgba(255,255,255,.06); border-radius: 999px; }

    .badge{ display:inline-flex; align-items:center; padding:2px 8px; border-radius:999px; font-size:11px; font-weight:700; border:1px solid rgba(255,255,255,.12); }
    .b-hot{ background: rgba(255,130,80,.12); border-color: rgba(255,180,120,.16); color: rgba(255,220,200,.95); }
    .b-new{ background: rgba(80,210,255,.12); border-color: rgba(120,240,255,.16); color: rgba(210,250,255,.95); }
    .b-sold{ background: rgba(255,70,120,.12); border-color: rgba(255,120,160,.16); color: rgba(255,220,230,.95); }
    .b-disc{ background: rgba(160,120,255,.12); border-color: rgba(200,170,255,.16); color: rgba(235,225,255,.95); }

    /* modal */
    .modal-open{ overflow:hidden; }
  </style>
</head>

<body class="text-white font-sans selection:bg-white/15 selection:text-white overflow-x-hidden min-h-screen bg-[#070A12]">
  <div class="bg-grid"></div>
  <div class="bg-vignette"></div>

  <div class="app">
    <!-- NAV -->
    <header class="sticky top-0 z-50">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-3">
        <nav class="glass rounded-2xl px-4 sm:px-5 py-3 flex items-center justify-between max-w-full">
          <a href="index.html" class="flex items-center gap-3 min-w-0">
            <div class="g-border h-10 w-10 rounded-xl overflow-hidden grid place-items-center flex-none">
              <div class="inner h-full w-full grid place-items-center">
                <div class="h-6 w-6 text-white/90" data-lucide="sparkles"></div>
              </div>
            </div>
            <div class="leading-tight min-w-0">
              <div class="text-sm text-white/85 font-semibold truncate">ASTRIONHUB</div>
              <div class="text-xs text-white/50 truncate">Pricing</div>
            </div>
          </a>

          <div class="hidden md:flex items-center gap-6 text-sm text-white/75">
            <a class="hover:text-white transition" href="features.html">Features</a>
            <a class="hover:text-white transition" href="snipsets.html">Snipsets</a>
            <a class="hover:text-white transition" href="demo.html">Demo</a>
            <a class="hover:text-white transition" href="pricing.html">Pricing</a>
            <a class="hover:text-white transition" href="contact.html">Contact</a>
          </div>

          <button id="btnMenu" class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 transition" aria-label="Open menu">
            <span class="h-5 w-5" data-lucide="menu"></span>
          </button>
        </nav>

        <div id="mobileMenu" class="hidden md:hidden mt-3 glass rounded-2xl px-4 py-3 max-w-full">
          <div class="grid gap-1 text-sm text-white/80">
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="features.html">Features</a>
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="snipsets.html">Snipsets</a>
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="demo.html">Demo</a>
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="pricing.html">Pricing</a>
            <a class="px-3 py-2 rounded-xl hover:bg-white/7 transition" href="contact.html">Contact</a>
          </div>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-10 pb-14">
      <section class="reveal">
        <div class="g-border w-full max-w-full">
          <div class="inner glass-strong rounded-2xl p-6 sm:p-8 w-full max-w-full">
            <div class="flex items-start justify-between gap-4 flex-wrap min-w-0">
              <div class="min-w-0">
                <div class="text-xs text-white/55">Pricing</div>
                <h1 class="mt-2 text-3xl sm:text-4xl font-extrabold tracking-tight">Pilih produk</h1>
                <p class="mt-3 text-white/70 max-w-2xl">
                  Data produk dibaca dari JSON. Ada tag hot/new/sold + diskon otomatis.
                </p>
              </div>

              <!-- toggle category -->
              <div class="glass rounded-2xl border border-white/10 p-1 flex items-center gap-1">
                <button id="tabPtero" class="px-4 py-2 rounded-2xl bg-white text-black font-semibold text-sm">Server Pterodactyl</button>
                <button id="tabSource" class="px-4 py-2 rounded-2xl bg-white/5 hover:bg-white/8 text-white/80 font-semibold text-sm">Source code</button>
              </div>
            </div>

            <div class="mt-6 grid lg:grid-cols-12 gap-4 min-w-0">
              <div class="lg:col-span-7 min-w-0">
                <div class="glass rounded-2xl border border-white/10 px-4 py-3 flex items-center gap-3 min-w-0">
                  <span class="h-4 w-4 text-white/60 flex-none" data-lucide="search"></span>
                  <input id="q" class="w-full bg-transparent outline-none text-sm text-white/90 placeholder:text-white/35 min-w-0"
                         placeholder="Cari produk..." />
                  <button id="btnClear" class="inline-flex items-center justify-center h-9 w-9 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 transition flex-none" aria-label="Clear">
                    <span class="h-4 w-4" data-lucide="x"></span>
                  </button>
                </div>
              </div>

              <div class="lg:col-span-5 min-w-0">
                <div class="glass rounded-2xl border border-white/10 p-4">
                  <div class="flex items-center justify-between text-xs text-white/60">
                    <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="layers"></span>Stat</span>
                    <span class="text-white/50" id="meta">0</span>
                  </div>
                  <div class="mt-3 grid grid-cols-3 gap-2">
                    <div class="rounded-2xl border border-white/10 bg-white/5 p-3">
                      <div class="text-xs text-white/55">Total</div>
                      <div class="mt-1 font-extrabold text-lg" id="stTotal">0</div>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-white/5 p-3">
                      <div class="text-xs text-white/55">Hot</div>
                      <div class="mt-1 font-extrabold text-lg" id="stHot">0</div>
                    </div>
                    <div class="rounded-2xl border border-white/10 bg-white/5 p-3">
                      <div class="text-xs text-white/55">Sold</div>
                      <div class="mt-1 font-extrabold text-lg" id="stSold">0</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- grid -->
            <div id="grid" class="mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-4 min-w-0"></div>

            <div id="stateError" class="hidden mt-6 glass rounded-2xl border border-rose-300/15 bg-rose-500/10 p-5">
              <div class="flex items-start gap-3 min-w-0">
                <span class="h-5 w-5 text-rose-200 flex-none" data-lucide="triangle-alert"></span>
                <div class="min-w-0">
                  <div class="font-semibold text-rose-100">Gagal load pricing.json</div>
                  <div id="errorText" class="mt-1 text-sm text-rose-100/80 break-all"></div>
                  <div class="mt-3 text-xs text-rose-100/70">
                    Tip: kalau raw github keblok / mime type bermasalah, host json via GitHub Pages domain yang sama. [web:437]
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- PAY MODAL -->
  <div id="modal" class="hidden fixed inset-0 z-[999]">
    <div id="modalBackdrop" class="absolute inset-0 bg-black/70"></div>

    <div class="relative mx-auto max-w-2xl w-full px-4 sm:px-6 lg:px-8 py-10">
      <div class="g-border w-full max-w-full">
        <div class="inner glass-strong rounded-2xl p-5 sm:p-6 w-full max-w-full overflow-hidden">
          <div class="flex items-start justify-between gap-3 min-w-0">
            <div class="min-w-0">
              <div class="text-xs text-white/55">Checkout</div>
              <div id="mTitle" class="mt-1 text-xl sm:text-2xl font-extrabold tracking-tight truncate">—</div>
              <div id="mPrice" class="mt-1 text-sm text-white/70 break-all">—</div>
            </div>

            <button id="btnClose" class="inline-flex items-center justify-center h-10 w-10 rounded-xl border border-white/10 bg-white/5 hover:bg-white/8 transition flex-none" aria-label="Close">
              <span class="h-5 w-5" data-lucide="x"></span>
            </button>
          </div>

          <form id="payForm" class="mt-5 grid gap-3">
            <div class="grid sm:grid-cols-2 gap-3">
              <label class="grid gap-1">
                <span class="text-xs text-white/60">Nama</span>
                <input id="fName" required class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/90 placeholder:text-white/35 outline-none focus:border-white/25"
                       placeholder="Nama kamu" />
              </label>
              <label class="grid gap-1">
                <span class="text-xs text-white/60">Nomor WhatsApp</span>
                <input id="fPhone" required class="w-full rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-white/90 placeholder:text-white/35 outline-none focus:border-white/25"
                       placeholder="62xxxxxxxxxxx" />
              </label>
            </div>

            <div class="glass rounded-2xl border border-white/10 p-4">
              <div class="text-sm font-semibold text-white/85">Pilih metode pembayaran</div>
              <div class="mt-3 grid sm:grid-cols-2 gap-2">
                <button type="button" data-pay="dana" class="payBtn inline-flex items-center justify-between gap-3 px-4 py-3 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8 transition">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="wallet"></span> DANA</span>
                  <span class="text-xs text-white/50">Coming soon</span>
                </button>
                <button type="button" data-pay="ovo" class="payBtn inline-flex items-center justify-between gap-3 px-4 py-3 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8 transition">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="wallet"></span> OVO</span>
                  <span class="text-xs text-white/50">Coming soon</span>
                </button>
                <button type="button" data-pay="gopay" class="payBtn inline-flex items-center justify-between gap-3 px-4 py-3 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8 transition">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="wallet"></span> GoPay</span>
                  <span class="text-xs text-white/50">Coming soon</span>
                </button>
                <button type="button" data-pay="seabank" class="payBtn inline-flex items-center justify-between gap-3 px-4 py-3 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8 transition">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="landmark"></span> SeaBank</span>
                  <span class="text-xs text-white/50">Coming soon</span>
                </button>
                <button type="button" data-pay="qris" class="payBtn inline-flex items-center justify-between gap-3 px-4 py-3 rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8 transition">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="qr-code"></span> QRIS</span>
                  <span class="text-xs text-white/50">Open QR</span>
                </button>
                <button type="button" data-pay="wa" class="payBtn inline-flex items-center justify-between gap-3 px-4 py-3 rounded-2xl bg-white text-black hover:bg-white/90 transition font-semibold">
                  <span class="inline-flex items-center gap-2"><span class="h-4 w-4" data-lucide="message-circle"></span> WhatsApp</span>
                  <span class="text-xs text-black/60">Chat</span>
                </button>
              </div>
            </div>

            <div id="qrisBox" class="hidden glass rounded-2xl border border-white/10 p-4">
              <div class="text-sm font-semibold text-white/85">QRIS</div>
              <div class="mt-2 text-sm text-white/65">Klik gambar untuk buka link QRIS (dari JSON).</div>
              <button type="button" id="btnQrisOpen" class="mt-3 w-full overflow-hidden rounded-2xl border border-white/10 bg-white/5 hover:bg-white/8 transition">
                <img id="qrisImg" alt="QRIS" class="w-full h-auto block" />
              </button>
            </div>

            <div id="payNote" class="hidden text-sm text-white/70"></div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    // menu
    const btnMenu = document.getElementById("btnMenu");
    const mobileMenu = document.getElementById("mobileMenu");
    btnMenu?.addEventListener("click", () => mobileMenu.classList.toggle("hidden"));
    mobileMenu?.querySelectorAll("a").forEach(a => a.addEventListener("click", () => mobileMenu.classList.add("hidden")));

    // reveal
    const rev = document.querySelector(".reveal");
    if (rev) {
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => { if (e.isIntersecting) rev.classList.add("show"); });
      }, { threshold: 0.12 });
      io.observe(rev);
    }

    // ===== JSON URLs =====
    const JSON_URLS = [
      "https://raw.githubusercontent.com/septianhdnatta/Website-/refs/heads/main/db/pricing.json",
      "https://raw.githubusercontent.com/septianhdnatta/Website-/main/db/pricing.json"
    ];

    // ===== Schema expected =====
    // {
    //   "payments": { "qrisImage": "https://...", "qrisLink": "https://...", "whatsappNumber": "62xxxx" },
    //   "pterodactyl": [ {id,title,price,discount,tags:["hot","new","popular"],soldOut:false} ],
    //   "sourceCode": [ {id,title,price,discount,tags:["hot","new"],soldOut:false} ]
    // }
    //
    // NOTE: kamu bilang ptero server 1-10GB + unlimited => itu bisa kamu simpan sebagai array item di pricing.json.

    const state = {
      tab: "ptero",
      q: "",
      data: null,
      payments: { qrisImage: "", qrisLink: "", whatsappNumber: "" },
      items: []
    };

    const elGrid = document.getElementById("grid");
    const elMeta = document.getElementById("meta");
    const elStTotal = document.getElementById("stTotal");
    const elStHot = document.getElementById("stHot");
    const elStSold = document.getElementById("stSold");

    const tabPtero = document.getElementById("tabPtero");
    const tabSource = document.getElementById("tabSource");
    const qInput = document.getElementById("q");

    document.getElementById("btnClear").addEventListener("click", () => {
      qInput.value = "";
      state.q = "";
      render();
    });
    qInput.addEventListener("input", (e) => {
      state.q = e.target.value || "";
      render();
    });

    function fmtRupiah(n){
      const x = Number(n || 0);
      return "Rp" + x.toLocaleString("id-ID");
    }

    function computeDiscounted(price, discount){
      const p = Number(price || 0);
      const d = Math.max(0, Math.min(90, Number(discount || 0)));
      if (!d) return { final: p, has: false, pct: 0 };
      const final = Math.round(p * (100 - d) / 100);
      return { final, has: true, pct: d };
    }

    function normItems(data){
      const payments = data?.payments || data?.payment || {};
      state.payments = {
        qrisImage: payments.qrisImage || payments.qris_image || payments.qris || "",
        qrisLink: payments.qrisLink || payments.qris_link || "",
        whatsappNumber: payments.whatsappNumber || payments.whatsapp || payments.wa || ""
      };

      const ptero = Array.isArray(data?.pterodactyl) ? data.pterodactyl
        : Array.isArray(data?.serverPterodactyl) ? data.serverPterodactyl
        : [];
      const source = Array.isArray(data?.sourceCode) ? data.sourceCode
        : Array.isArray(data?.source) ? data.source
        : [];

      return { ptero, source };
    }

    async function fetchFirstWorkingJson(){
      let lastErr = null;
      for (const base of JSON_URLS) {
        try {
          const url = base + (base.includes("?") ? "&" : "?") + "t=" + Date.now();
          const res = await fetch(url, { cache: "no-store" });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return await res.json();
        } catch(e){ lastErr = e; }
      }
      throw lastErr || new Error("Fetch failed");
    }

    function setTab(tab){
      state.tab = tab;
      const p = tab === "ptero";
      tabPtero.className = "px-4 py-2 rounded-2xl font-semibold text-sm " + (p ? "bg-white text-black" : "bg-white/5 hover:bg-white/8 text-white/80");
      tabSource.className = "px-4 py-2 rounded-2xl font-semibold text-sm " + (!p ? "bg-white text-black" : "bg-white/5 hover:bg-white/8 text-white/80");
      render();
    }

    tabPtero.addEventListener("click", () => setTab("ptero"));
    tabSource.addEventListener("click", () => setTab("source"));

    function hasTag(item, tag){
      const tags = item?.tags || item?.tag || [];
      if (typeof tags === "string") return tags.toLowerCase().includes(tag);
      if (Array.isArray(tags)) return tags.map(x => String(x).toLowerCase()).includes(tag);
      return false;
    }

    function renderBadges(item, disc){
      const out = [];
      if (hasTag(item, "hot")) out.push(`<span class="badge b-hot">HOT</span>`);
      if (hasTag(item, "popular")) out.push(`<span class="badge b-hot">POPULAR</span>`);
      if (hasTag(item, "new")) out.push(`<span class="badge b-new">NEW</span>`);
      if (item?.soldOut || hasTag(item, "sold")) out.push(`<span class="badge b-sold">SOLD</span>`);
      if (disc?.has) out.push(`<span class="badge b-disc">-${disc.pct}%</span>`);
      return out.join("");
    }

    function matchQuery(item, q){
      const s = (String(item?.title||"") + " " + String(item?.name||"") + " " + String(item?.id||"")).toLowerCase();
      return s.includes(q.toLowerCase().trim());
    }

    function card(item){
      const title = String(item.title || item.name || "Untitled");
      const basePrice = Number(item.price || 0);
      const disc = computeDiscounted(basePrice, item.discount);
      const sold = !!item.soldOut || hasTag(item, "sold");

      const priceHTML = disc.has
        ? `<div class="flex items-end gap-2">
             <div class="text-3xl font-extrabold tracking-tight">${fmtRupiah(disc.final)}</div>
             <div class="text-sm text-white/45 line-through pb-1">${fmtRupiah(basePrice)}</div>
           </div>`
        : `<div class="text-3xl font-extrabold tracking-tight">${fmtRupiah(basePrice)}</div>`;

      return `
        <button data-buy="${String(item.id || title)}"
          class="text-left glass rounded-2xl border border-white/10 p-5 w-full max-w-full overflow-hidden hover:bg-white/7 hover:border-white/20 transition ${sold ? "opacity-75" : ""}">
          <div class="flex items-start justify-between gap-3">
            <div class="min-w-0">
              <div class="font-semibold text-white/90 truncate">${title}</div>
              <div class="mt-2">${priceHTML}</div>
            </div>
            <div class="flex flex-wrap gap-2 justify-end flex-none">
              ${renderBadges(item, disc)}
            </div>
          </div>
          <div class="mt-4 text-sm text-white/65 break-words">${String(item.description || item.desc || "")}</div>
          <div class="mt-5">
            <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full ${sold ? "bg-rose-500/10 border border-rose-300/15 text-rose-100/90" : "bg-white text-black"} text-sm font-semibold">
              <span class="h-4 w-4" data-lucide="${sold ? "ban" : "shopping-cart"}"></span>
              ${sold ? "Stok habis" : "Pilih metode bayar"}
            </span>
          </div>
        </button>
      `;
    }

    function render(){
      if (!state.data) return;

      const q = (state.q || "").trim().toLowerCase();
      const items = (state.tab === "ptero" ? state.itemsPtero : state.itemsSource) || [];
      const view = q ? items.filter(it => matchQuery(it, q)) : items;

      elGrid.innerHTML = view.map(card).join("");
      elMeta.textContent = `${view.length}/${items.length}`;

      const hotCount = items.filter(it => hasTag(it, "hot")).length;
      const soldCount = items.filter(it => !!it.soldOut || hasTag(it, "sold")).length;
      elStTotal.textContent = String(items.length);
      elStHot.textContent = String(hotCount);
      elStSold.textContent = String(soldCount);

      // bind buy
      elGrid.querySelectorAll("[data-buy]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-buy");
          const it = items.find(x => String(x.id || x.title || x.name) === id) || null;
          if (!it) return;
          if (!!it.soldOut || hasTag(it, "sold")) return;
          openModal(it);
        });
      });

      lucide.createIcons();
    }

    // ===== Modal logic =====
    const modal = document.getElementById("modal");
    const modalBackdrop = document.getElementById("modalBackdrop");
    const btnClose = document.getElementById("btnClose");
    const payNote = document.getElementById("payNote");
    const qrisBox = document.getElementById("qrisBox");
    const qrisImg = document.getElementById("qrisImg");
    const btnQrisOpen = document.getElementById("btnQrisOpen");

    let selectedProduct = null;

    function showModal(yes){
      modal.classList.toggle("hidden", !yes);
      document.body.classList.toggle("modal-open", yes);
      lucide.createIcons();
    }

    function openModal(item){
      selectedProduct = item;

      const basePrice = Number(item.price || 0);
      const disc = computeDiscounted(basePrice, item.discount);

      document.getElementById("mTitle").textContent = String(item.title || item.name || "Produk");
      document.getElementById("mPrice").textContent =
        disc.has
          ? `${fmtRupiah(disc.final)} (diskon ${disc.pct}% dari ${fmtRupiah(basePrice)})`
          : `${fmtRupiah(basePrice)}`;

      // reset UI
      payNote.classList.add("hidden");
      payNote.textContent = "";
      qrisBox.classList.add("hidden");

      // set QR from JSON
      qrisImg.src = state.payments.qrisImage || "";
      btnQrisOpen.onclick = () => {
        const link = state.payments.qrisLink || state.payments.qrisImage || "";
        if (link) window.open(link, "_blank", "noopener,noreferrer");
      };

      showModal(true);
    }

    function closeModal(){
      showModal(false);
      selectedProduct = null;
    }

    btnClose.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", closeModal);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !modal.classList.contains("hidden")) closeModal();
    });

    // payment buttons
    document.querySelectorAll(".payBtn").forEach(btn => {
      btn.addEventListener("click", () => {
        const method = btn.getAttribute("data-pay");

        const name = (document.getElementById("fName").value || "").trim();
        const phone = (document.getElementById("fPhone").value || "").trim();
        if (!name || !phone) {
          payNote.textContent = "Isi Nama dan Nomor WhatsApp dulu.";
          payNote.classList.remove("hidden");
          qrisBox.classList.add("hidden");
          return;
        }

        if (method === "qris") {
          // show QR image area
          if (!state.payments.qrisImage && !state.payments.qrisLink) {
            payNote.textContent = "QRIS belum diset di JSON.";
            payNote.classList.remove("hidden");
            qrisBox.classList.add("hidden");
            return;
          }
          payNote.textContent = "QRIS: klik gambar untuk buka link (atau scan).";
          payNote.classList.remove("hidden");
          qrisBox.classList.remove("hidden");
          return;
        }

        if (method === "wa") {
          const wa = (state.payments.whatsappNumber || "").replace(/[^\d]/g, "");
          const basePrice = Number(selectedProduct?.price || 0);
          const disc = computeDiscounted(basePrice, selectedProduct?.discount);
          const priceText = disc.has ? `${fmtRupiah(disc.final)} (disc ${disc.pct}%)` : fmtRupiah(basePrice);
          const product = String(selectedProduct?.title || selectedProduct?.name || "Produk");

          const text = encodeURIComponent(
            `Halo, saya ${name} (${phone}).\n` +
            `Saya mau beli: ${product}\n` +
            `Harga: ${priceText}\n` +
            `Metode: WhatsApp\n\n` +
            `Status pembayaran: Coming soon (manual confirm).`
          );

                    if (!wa) {
            payNote.textContent = "Nomor WhatsApp belum diset di JSON (payments.whatsappNumber).";
            payNote.classList.remove("hidden");
            qrisBox.classList.add("hidden");
            return;
          }

          const waUrl = `https://wa.me/${wa}?text=${text}`;
          window.open(waUrl, "_blank", "noopener,noreferrer");
          payNote.textContent = "Membuka WhatsApp… (kalau belum terbuka, cek popup blocker).";
          payNote.classList.remove("hidden");
          qrisBox.classList.add("hidden");
          return;
        }

        // other methods (coming soon)
        const mapName = {
          dana: "DANA",
          ovo: "OVO",
          gopay: "GoPay",
          seabank: "SeaBank"
        };
        payNote.textContent = `${mapName[method] || "Metode"} masih Coming soon.`;
        payNote.classList.remove("hidden");
        qrisBox.classList.add("hidden");
      });
    });

    // ===== Load JSON then render =====
    (async function boot(){
      try {
        const data = await fetchFirstWorkingJson();
        state.data = data;

        const { ptero, source } = normItems(data);

        // Requirement kamu:
        // - Pterodactyl "Server 1 sampai 10 GB lalu unlimited" => simpan di JSON.
        // - Script membaca dari JSON saja => jadi di sini tidak generate default, cuma pakai yang ada.
        state.itemsPtero = Array.isArray(ptero) ? ptero : [];
        state.itemsSource = Array.isArray(source) ? source : [];

        // Default tab
        setTab("ptero");

        // hide error
        document.getElementById("stateError").classList.add("hidden");
      } catch (e) {
        const box = document.getElementById("stateError");
        const txt = document.getElementById("errorText");
        box.classList.remove("hidden");
        txt.textContent = String(e?.message || e);
      } finally {
        lucide.createIcons();
      }
    })();
  </script>
</body>
</html>
